<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clean dataset using influence functions and neural networks &mdash; pyDVL 0.1.0.dev13 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="valuation" href="../valuation/index.html" />
    <link rel="prev" title="KNN Shapley" href="knn_shapley.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> pyDVL
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guides and Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing pyDVL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="data_mislabel_correction_using_influence_functions.html">Influence functions for data mislabeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_mislabel_correction_using_influence_functions.html#Appendix">Appendix</a></li>
<li class="toctree-l2"><a class="reference internal" href="knn_shapley.html">KNN Shapley</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Clean dataset using influence functions and neural networks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Visualizing-the-multi-dimensional-data-using-a-TSNE-embedding-and-class-colors">Visualizing the multi-dimensional data using a TSNE embedding and class colors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fit-a-neural-network-to-the-data">Fit a neural network to the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-influences-for-small-neural-networks">Calculating influences for small neural networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Keeping-the-most-influential-samples">Keeping the most influential samples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../valuation/index.html">valuation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyDVL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Notebooks</a> &raquo;</li>
      <li>Clean dataset using influence functions and neural networks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/neural_networks_using_influence_functions.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Clean-dataset-using-influence-functions-and-neural-networks">
<h1>Clean dataset using influence functions and neural networks<a class="headerlink" href="#Clean-dataset-using-influence-functions-and-neural-networks" title="Permalink to this heading"></a></h1>
<p>A dataset usually consists of a lot of data points, while not all data points are equally important for achieving the desired accuracy. Sometimes it is necessary to speed up the gradient calculations or optimize the required RAM. Example applications are reinforcement learning or continuous optimal control tasks. This notebook</p>
<ul class="simple">
<li><p>shows how to calculate influences using the pyDVL library of an arbitrary (usually called training) set of data samples <span class="math notranslate nohighlight">\(X_\text{train} \subseteq \mathbb{R}^d\)</span> onto a test set <span class="math notranslate nohighlight">\(X_\text{test} \subseteq \mathbb{R}^d\)</span>.</p></li>
<li><p>shows a plot with the weighted F1-score on the y-axis and the number of samples on the x-axis.</p></li>
<li><p>selects the optimal number of samples for the dataset as induced by the influence functions.</p></li>
</ul>
<p>First, an arbitrary random dataset can be loaded or created using the <code class="docutils literal notranslate"><span class="pre">utils.dataset.Dataset</span></code> class. For showcase purposes</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_wine</span>
<span class="kn">from</span> <span class="nn">valuation.utils.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">wine_bunch</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">(</span><span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_sklearn</span><span class="p">(</span><span class="n">wine_bunch</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>the wine dataset is used. It can be loaded (as any other compatible dataset) directly from sklearn.</p>
<section id="Visualizing-the-multi-dimensional-data-using-a-TSNE-embedding-and-class-colors">
<h2>Visualizing the multi-dimensional data using a TSNE embedding and class colors<a class="headerlink" href="#Visualizing-the-multi-dimensional-data-using-a-TSNE-embedding-and-class-colors" title="Permalink to this heading"></a></h2>
<p>As usual a closer inspection of the data is helpful. Hence, the data is plotted by first encoding it using a TSNE embedding. This can be achieved by the following function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">valuation.utils.dataset</span> <span class="kn">import</span> <span class="n">dataset_tsne_encode</span><span class="p">,</span> <span class="n">dataset_to_json</span>
<span class="kn">from</span> <span class="nn">valuation.utils.plotting</span> <span class="kn">import</span> <span class="n">plot_datasets</span>

<span class="n">tsne_dataset</span> <span class="o">=</span> <span class="n">dataset_tsne_encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">tsne_dateset_json</span> <span class="o">=</span> <span class="n">dataset_to_json</span><span class="p">(</span><span class="n">tsne_dataset</span><span class="p">)</span>
<span class="n">plot_datasets</span><span class="p">(</span><span class="n">tsne_dateset_json</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;TSNE-encoded dataset with labels.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/pyDVL/pyDVL/.tox/test-notebooks/lib/python3.8/site-packages/sklearn/manifold/_t_sne.py:996: FutureWarning: The PCA initialization in TSNE will change to have the standard deviation of PC1 equal to 1e-4 in 1.2. This will ensure better convergence.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_neural_networks_using_influence_functions_3_1.png" src="../_images/notebooks_neural_networks_using_influence_functions_3_1.png" />
</div>
</div>
</section>
<section id="Fit-a-neural-network-to-the-data">
<h2>Fit a neural network to the data<a class="headerlink" href="#Fit-a-neural-network-to-the-data" title="Permalink to this heading"></a></h2>
<p>First, a 2-layer neural network is created and fitted with pyDVL. This can be achieved by the following</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">valuation.models</span> <span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span> <span class="n">TorchOptimizer</span><span class="p">,</span> <span class="n">NeuralNetworkTorchModel</span><span class="p">,</span> <span class="n">TorchObjective</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x_transformer</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>

<span class="n">transformed_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">x_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">x_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">feature_dimension</span> <span class="o">=</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">unique_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">)))</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_classes</span><span class="p">)</span>

<span class="n">network_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TorchModule</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">NeuralNetworkTorchModel</span><span class="p">(</span><span class="n">feature_dimension</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">network_size</span><span class="p">),</span>
    <span class="n">objective</span><span class="o">=</span><span class="n">TorchObjective</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">),</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">TorchOptimizer</span><span class="o">.</span><span class="n">ADAM</span><span class="p">,</span>
    <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
        <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
        <span class="s2">&quot;cosine_annealing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span>
    <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">y_train</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>code snippet. It creates a 2-layer neural network with 16 neurons in each hidden layer. After fitting the data, the TSNE embedded data along with the predicted values get displayed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pred_y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pred_y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">tsne_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">),</span>
    <span class="s1">&#39;train_predicted&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">tsne_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">pred_y_train</span><span class="p">),</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">tsne_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">),</span>
    <span class="s1">&#39;test_predicted&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">tsne_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">pred_y_test</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">plot_datasets</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;TSNE embedded samples of train and test set&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_neural_networks_using_influence_functions_7_0.png" src="../_images/notebooks_neural_networks_using_influence_functions_7_0.png" />
</div>
</div>
<p>A short visual inspection yields that all labels of the test set are now classified correctly. This can be verified by</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_y_test</span><span class="p">)</span>
<span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x7f789c321f40&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_neural_networks_using_influence_functions_9_1.png" src="../_images/notebooks_neural_networks_using_influence_functions_9_1.png" />
</div>
</div>
<p>plotting a confusion matrix using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> library. As one can see the accuracy is 100% for the selected model.</p>
</section>
<section id="Calculating-influences-for-small-neural-networks">
<h2>Calculating influences for small neural networks<a class="headerlink" href="#Calculating-influences-for-small-neural-networks" title="Permalink to this heading"></a></h2>
<p>The following section elaborates the calculation of influences through a neural network. It is noteworthy that the full Hessian matrix is constructed and used for inverting the gradients. This can only be achieved for small networks. In the case of a big network additionally conjugate gradient has to be used to perform approximate inversion. The influences for both the train and test set are calculated</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">valuation.influence.general</span> <span class="kn">import</span> <span class="n">influences</span>

<span class="n">inversion_method</span> <span class="o">=</span> <span class="s2">&quot;direct&quot;</span> <span class="c1"># cg for big networks</span>
<span class="n">test_influences</span> <span class="o">=</span> <span class="n">influences</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">inversion_method</span><span class="o">=</span><span class="n">inversion_method</span><span class="p">)</span>
<span class="n">train_influences</span> <span class="o">=</span> <span class="n">influences</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">inversion_method</span><span class="o">=</span><span class="n">inversion_method</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>by the preceding code snippet. Subsequently, the mean absolute influence of one train sample onto all test samples is calculated by</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_influences</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mean_train_influences</span> <span class="o">=</span> <span class="n">mean_influences</span><span class="p">(</span><span class="n">train_influences</span><span class="p">)</span>
<span class="n">mean_test_influences</span> <span class="o">=</span> <span class="n">mean_influences</span><span class="p">(</span><span class="n">test_influences</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>and plotted by</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">influence_datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">tsne_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">mean_train_influences</span><span class="p">),</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">tsne_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">mean_test_influences</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">plot_datasets</span><span class="p">(</span><span class="n">influence_datasets</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_neural_networks_using_influence_functions_15_0.png" src="../_images/notebooks_neural_networks_using_influence_functions_15_0.png" />
</div>
</div>
<p>a visual inspection yields that there are indeed different influential samples.</p>
</section>
<section id="Keeping-the-most-influential-samples">
<h2>Keeping the most influential samples<a class="headerlink" href="#Keeping-the-most-influential-samples" title="Permalink to this heading"></a></h2>
<p>Using the pyDVL library, the next section selects the most influential samples and retrains the model using the shortened dataset. This is done over the number of samples to showcase how the weighted F1-score changes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display_functions</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">num_estimates_per_samples</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">min_num_samples</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">x_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_num_samples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">num_shortened_samples</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_range</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">summed_metric</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_estimates_per_samples</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">mean_train_influences</span><span class="p">))[:</span><span class="n">num_shortened_samples</span><span class="p">]</span>
        <span class="n">shortened_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="p">)</span>
        <span class="n">shortened_dataset</span><span class="o">.</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">shortened_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">shortened_dataset</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">shortened_dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">shortened_model</span> <span class="o">=</span> <span class="n">TorchModule</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">NeuralNetworkTorchModel</span><span class="p">(</span><span class="n">feature_dimension</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">network_size</span><span class="p">),</span>
            <span class="n">objective</span><span class="o">=</span><span class="n">TorchObjective</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">),</span>
            <span class="n">num_epochs</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="n">TorchOptimizer</span><span class="o">.</span><span class="n">ADAM</span><span class="p">,</span>
            <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
                <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
                <span class="s2">&quot;cosine_annealing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">shortened_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">shortened_dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span>
            <span class="n">shortened_dataset</span><span class="o">.</span><span class="n">y_train</span>
        <span class="p">)</span>
        <span class="n">pred_y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">shortened_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">summed_metric</span> <span class="o">+=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">shortened_dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_y_test</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>

    <span class="n">metrics</span><span class="p">[</span><span class="n">num_shortened_samples</span><span class="p">]</span> <span class="o">=</span> <span class="n">summed_metric</span> <span class="o">/</span> <span class="n">num_estimates_per_samples</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 1/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 2/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 3/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 4/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 5/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 6/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 7/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 8/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 9/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 10/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 11/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 12/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 13/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 14/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 15/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 16/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 17/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 18/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 19/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 20/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 21/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 22/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 23/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 24/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 25/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 26/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 27/29&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 28/29&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Iteration 29/29&#39;
</pre></div></div>
</div>
<p>Note, how the model is created completely new and is not derived from the previous model. This section showcases how to use the influence calculations The notebook finishes by plotting</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;#samples&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;F1 score&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Weighted F1-Score over test set for number of most influential samples.&quot;</span><span class="p">)</span>
<span class="n">hline_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span>
<span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">hline_kwargs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">hline_kwargs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_neural_networks_using_influence_functions_19_0.png" src="../_images/notebooks_neural_networks_using_influence_functions_19_0.png" />
</div>
</div>
<p>the optimal number of samples on the x-axis along with the weighted F1-score on the y-axis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_number_of_samples</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
<span class="sa">f</span><span class="s2">&quot;The optimal number of samples is </span><span class="si">{</span><span class="n">optimal_number_of_samples</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;The optimal number of samples is 66&#39;
</pre></div></div>
</div>
<p>Over multiple runs with different the optimal number of samples canges, but it can be said to be safe to remove around 30% of the samples of the wine dataset to easily achieve the same data accuracy.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="knn_shapley.html" class="btn btn-neutral float-left" title="KNN Shapley" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../valuation/index.html" class="btn btn-neutral float-right" title="valuation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
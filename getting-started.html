<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting started &mdash; pyDVL 0.1.0.dev28 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installing pyDVL" href="install.html" />
    <link rel="prev" title="pyDVL Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-dataset">Creating Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-utility">Creating Utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-leave-one-out-values">Computing Leave-One-Out values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-shapley-values">Computing Shapley values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-influence-values">Computing Influence values</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#direct-linear-influences">Direct linear influences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exact-influences-using-twicedifferentiable-protocol">Exact influences using TwiceDifferentiable protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#influences-using-twicedifferentiable-protocol-and-approximate-matrix-inversion">Influences using TwiceDifferentiable protocol and approximate matrix inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#perturbation-influences">Perturbation influences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What’s next</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing pyDVL</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="valuation/index.html">valuation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyDVL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Getting started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/getting-started.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="getting-started">
<span id="id1"></span><h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h1>
<p>Make sure you have <a class="reference internal" href="install.html#pydvl-installation"><span class="std std-ref">installed pyDVL</span></a> before proceeding further.</p>
<p>In order to use the library, you need to use <a class="reference external" href="https://memcached.org/">Memcached</a>,
an in-memory key-value store for small chunks of arbitrary data (strings, objects),
in order to cache certain results and speed-up the computations.</p>
<p>You can either install it directly on your system and run it. For that refer to the
<a class="reference external" href="https://github.com/memcached/memcached/wiki#getting-started">Getting Started section</a>
of Memcached’s wiki. You can run it using:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ memcached -u user
</pre></div>
</div>
<p>Or you can run it inside a container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ docker container run -it --rm -p <span class="m">11211</span>:11211 memcached:latest -v
</pre></div>
</div>
<p>Caching is enabled by default but can be disabled if not needed or desired.</p>
<section id="creating-dataset">
<h2>Creating Dataset<a class="headerlink" href="#creating-dataset" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="valuation/utils/dataset.html#valuation.utils.dataset.Dataset" title="valuation.utils.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> class is a convenient wrapper
for the train and test splits that is used throughout the codebase. It can be used as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.utils</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">16</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-utility">
<h2>Creating Utility<a class="headerlink" href="#creating-utility" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="valuation/utils/utility.html#valuation.utils.utility.Utility" title="valuation.utils.utility.Utility"><code class="xref py py-class docutils literal notranslate"><span class="pre">Utility</span></code></a> class is a convenient wrapper
for the dataset, model and scoring function. It is used in the Leave-One-Out and Shapley methods.
It can be used as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.utils</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Utility</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utility</span> <span class="o">=</span> <span class="n">Utility</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="computing-leave-one-out-values">
<h2>Computing Leave-One-Out values<a class="headerlink" href="#computing-leave-one-out-values" title="Permalink to this heading"></a></h2>
<p>The Leave-One-Out method is a naive approach that should only be used for testing purposes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.loo.naive</span> <span class="kn">import</span> <span class="n">naive_loo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utility</span> <span class="o">=</span> <span class="n">Utility</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">naive_loo</span><span class="p">(</span><span class="n">utility</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="computing-shapley-values">
<h2>Computing Shapley values<a class="headerlink" href="#computing-shapley-values" title="Permalink to this heading"></a></h2>
<p>The Shapley method is a game-theoretic approach to compute data valuation.
Here we use Truncated Montecarlo Shapley because it is the most efficient.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.utils</span> <span class="kn">import</span> <span class="n">Utility</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.shapley.montecarlo</span> <span class="kn">import</span> <span class="n">truncated_montecarlo_shapley</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.reporting.plots</span> <span class="kn">import</span> <span class="n">shapley_results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utility</span> <span class="o">=</span> <span class="n">Utility</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">truncated_montecarlo_shapley</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">utility</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scores</span> <span class="o">=</span> <span class="n">compute_fb_scores</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">utility</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">utility</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shapley_results</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="computing-influence-values">
<h2>Computing Influence values<a class="headerlink" href="#computing-influence-values" title="Permalink to this heading"></a></h2>
<p>There are two ways to compute influences. For linear regressions, the influences can be computed
analytically (this is used in testing as well). For more general models or loss functions,
we can use the <code class="docutils literal notranslate"><span class="pre">TwiceDifferentiable</span></code> protocol, which provides the required methods for computing the influences.</p>
<p>In general there are two types of influences, namely Up-weighting and Perturbation influences.
Each method supports the choice of one ot them by pinning an enumeration in the parameters.
Furthermore, we distinguish between the following types of calculations:</p>
<section id="direct-linear-influences">
<h3>Direct linear influences<a class="headerlink" href="#direct-linear-influences" title="Permalink to this heading"></a></h3>
<p>These can only be applied to a regression problem where x and y are real numbers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.influence.linear</span> <span class="kn">import</span> <span class="n">compute_linear_influences</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_linear_influences</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">x_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_test</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_test</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Internally this method fits a linear regression model and uses it
to subsequently calculate the influences. Take a closer look at their inner definition, to reuse a model
in calculation or optimize the calculation for your specific application.</p>
</section>
<section id="exact-influences-using-twicedifferentiable-protocol">
<h3>Exact influences using TwiceDifferentiable protocol<a class="headerlink" href="#exact-influences-using-twicedifferentiable-protocol" title="Permalink to this heading"></a></h3>
<p>If you create a model, which supports the <code class="docutils literal notranslate"><span class="pre">TwiceDifferentiable</span></code> protocol. This means that it is
capable of calculating second derivative matrix vector products and gradients with respect to the
loss and data samples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.influence</span> <span class="kn">import</span> <span class="n">influences</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_influences</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">model</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_test</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_test</span><span class="p">,,</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="influences-using-twicedifferentiable-protocol-and-approximate-matrix-inversion">
<h3>Influences using TwiceDifferentiable protocol and approximate matrix inversion<a class="headerlink" href="#influences-using-twicedifferentiable-protocol-and-approximate-matrix-inversion" title="Permalink to this heading"></a></h3>
<p>Sometimes it is not possible to construct the complete Hessian in memory.
In that case one can use conjugate gradient as a space-efficient
approximation to inverting the full matrix. In pyDVL this can be done
by adding <code class="docutils literal notranslate"><span class="pre">inversion_method</span></code> parameter to the influences function call.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.influence</span> <span class="kn">import</span> <span class="n">compute_influences</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_influences</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">model</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_test</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_test</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">inversion_method</span><span class="o">=</span><span class="s2">&quot;cg&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="perturbation-influences">
<h3>Perturbation influences<a class="headerlink" href="#perturbation-influences" title="Permalink to this heading"></a></h3>
<p>All previous mentioned influences can be calculated feature-wise by adding <code class="docutils literal notranslate"><span class="pre">influence_type</span></code> parameter
to the influences function call.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">valuation.influence</span> <span class="kn">import</span> <span class="n">compute_influences</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_influences</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">model</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_train</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">x_test</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">y_test</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">influence_type</span><span class="o">=</span><span class="s2">&quot;perturbation&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="what-s-next">
<h2>What’s next<a class="headerlink" href="#what-s-next" title="Permalink to this heading"></a></h2>
<p>You should go to the <a class="reference internal" href="examples/index.html#examples"><span class="std std-ref">Examples</span></a> section of the documentation
to see more detailed usage of the library.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="pyDVL Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="install.html" class="btn btn-neutral float-right" title="Installing pyDVL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>